<script type="text/javascript" charset="utf-8">
  $(function () {
    var 
      ratio_week = <%= raw str[:opened].first.to_json %>
      ratio_month = <%= raw str[:opened][1].to_json %>;
      ratio_year = <%= raw str[:opened][2].to_json %>;
      ratio_all = <%= raw str[:opened].last.to_json %>;
      difference_week = <%= raw str[:closed].first.to_json %>;
      difference_month = <%= raw str[:closed].first(2).last.to_json %>;
      difference_year = <%= raw str[:closed].last(2).first.to_json %>;
      difference_all = <%= raw str[:closed].last.to_json %>
      link_closed = '<%= root_url %>/issue_statistics/closed_issues/<%= stat_per_user %>';
      link_opened = '<%= root_url %>/issue_statistics/opened_issues/<%= stat_per_user %>';
    
    $('#<%= stat_per_user %>open_close').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: ''
        },
        xAxis: {
            categories: <%= raw periods.to_json %>
        },
        yAxis: {
            min: 0,
            title: {
                text: ''
            }
        },
        legend: {
            reversed: true
        },
        credits: {
          text: ''
        },
        tooltip: {
          formatter: function() {
                      return this.series.name + ' : ' + this.y ;
                    }
        },
        plotOptions: {
            series: {
                stacking: 'normal',
                cursor: 'pointer',
                point: {
                  events: {
                      click: function (event) {
                          if (event.point.url){
                            window.location.href = event.point.url + "/" + this.category + '/<%= relate_id && "?relate_id=#{relate_id}" %>';
                          }
                      }
                  }
              }
            }
        },
        series: [
            {
            color: '#434348',
            name: "<%=l(:field_opened)%>",
            data: [
                  { y: ratio_week, url: link_opened  }, 
                  { y: ratio_month, url: link_opened },
                  { y: ratio_year, url: link_opened },
                  { y: ratio_all, url: link_opened }]
            },
            {
            color: '#90ed7d',
            name: "<%=l(:field_closed)%>",
            data: [
                  { y: difference_week, url: link_closed },
                  { y: difference_month, url: link_closed },
                  { y: difference_year, url: link_closed },
                  { y: difference_all, url: link_closed }]
            }]
    });
  });
</script>